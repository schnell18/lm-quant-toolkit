) |>
collapse_rows(columns = 2, latex_hline = "major")
tabular <- gsub(
"\\begin{tabular}",
"\\begin{adjustbox}{width=\\textwidth,keepaspectratio}\n\\begin{tabular}",
tabular,
fixed = TRUE
)
tabular <- gsub(
"\\end{tabular}",
"\\end{tabular}\n\\end{adjustbox}",
tabular,
fixed = TRUE
)
head <- r"(
\documentclass{article}
\usepackage{booktabs,makecell,multirow,threeparttable}
\usepackage{adjustbox}
\begin{document}
)"
tail <- r"(
\end{document}
)"
out <- paste(
head,
tabular,
tail,
sep = "\n"
)
fh <- file(latex_file)
writeLines(out, fh)
close(fh)
}
args <- commandArgs(trailingOnly = TRUE)
if (length(args) == 0) {
csv_fp <- "data/combined.csv"
} else {
csv_fp <- args[1]
}
all_cols <- c(
"model", "algo", "config",
"bpp", "ppl_wikitext", "ppl_c4",
"memory"
)
csv_fp <- "/fdata/llm/mxq/results/tail-boost/data/combined.csv"
df_all <- read_csv(csv_fp) |>
filter(
is.na(attempt)
) |>
mutate(
ppl_wikitext = round(ppl_wikitext, digits = 2),
ppl_c4 = round(ppl_c4, digits = 2),
memory = round(load_mem_allot, digits = 2)
) |>
mutate(
model = factor(
model,
levels = c("Llama-2-7b-hf", "Llama-2-13b-hf", "Meta-Llama-3-8B"),
labels = c("Llama-2-7B", "Llama-2-13B", "Llama-3-8B")
),
algo = factor(
algo,
levels = c("mxq", "fp16", "awq", "gptq", "bnb", "hqq"),
labels = c("MXQ", "FP16", "AWQ", "GPTQ", "BnB", "HQQ"),
),
config = factor(
config,
levels = c(
"base",
"b4g32", "b4g64", "b4g128",
"b3g32", "b3g64", "b3g128"
# "4_51", "4_25", "4_13",
# "3_51", "3_25", "3_13",
# "3_65", "6_89", "5_72",
# "3_07", "4_01", "5_02",
)
)
) |>
select(all_of(all_cols))
latex_cols <- c(
"algo", "config", "bpp",
"ppl_wikitext_Llama-2-7B", "ppl_c4_Llama-2-7B", "memory_Llama-2-7B",
"ppl_wikitext_Llama-2-13B", "ppl_c4_Llama-2-13B", "memory_Llama-2-13B",
"ppl_wikitext_Llama-3-8B", "ppl_c4_Llama-3-8B", "memory_Llama-3-8B"
)
df_latex <- df_all |>
filter(bpp >= 3.03 & bpp < 8.0 | bpp >= 16.00) |>
# filter(
#   algo != "MXQ" |
#     bpp == 4.51 |
#     bpp == 4.25 |
#     bpp == 4.13 |
#     bpp == 3.51 |
#     bpp == 3.25 |
#     bpp == 3.13 |
#     bpp == 3.65 |
#     bpp == 5.72 |
#     bpp == 6.89 |
#     bpp == 3.07 |
#     bpp == 4.01 |
#     bpp == 5.02
# ) |>
pivot_wider(
names_from = model,
values_from = c(ppl_wikitext, ppl_c4, memory),
names_vary = "slowest"
) |>
select(all_of(latex_cols)) |>
arrange(config)
View(df_latex)
View(df_all)
csv_fp <- "/fdata/llm/mxq/results/tail-boost/data/combined.csv"
df_all <- read_csv(csv_fp) |>
# filter(
#   is.na(attempt)
# ) |>
mutate(
ppl_wikitext = round(ppl_wikitext, digits = 2),
ppl_c4 = round(ppl_c4, digits = 2),
memory = round(load_mem_allot, digits = 2)
) |>
mutate(
model = factor(
model,
levels = c("Llama-2-7b-hf", "Llama-2-13b-hf", "Meta-Llama-3-8B"),
labels = c("Llama-2-7B", "Llama-2-13B", "Llama-3-8B")
),
algo = factor(
algo,
levels = c("mxq", "fp16", "awq", "gptq", "bnb", "hqq"),
labels = c("MXQ", "FP16", "AWQ", "GPTQ", "BnB", "HQQ"),
),
config = factor(
config,
levels = c(
"base",
"b4g32", "b4g64", "b4g128",
"b3g32", "b3g64", "b3g128"
# "4_51", "4_25", "4_13",
# "3_51", "3_25", "3_13",
# "3_65", "6_89", "5_72",
# "3_07", "4_01", "5_02",
)
)
) |>
select(all_of(all_cols))
View(df_all)
source("~/work/lm-quant-toolkit/data-vis/gen-table-mxq-llm.R")
View(df_all)
library(tidyverse)
args <- commandArgs(trailingOnly = TRUE)
if (length(args) == 0) {
csv_fp <- "data/llama-sensitivity1.csv"
} else {
csv_fp <- args[1]
}
df_all <- read_csv(csv_fp)
View(df_all)
df_layer <- df_all |>
group_by(model, layerA) |>
summarise(
sensitivity = sum(sensitivity)
) |>
arrange(sensitivity)
df_layer <- df_all |>
group_by(model, layer) |>
summarise(
sensitivity = sum(sensitivity)
) |>
arrange(sensitivity)
View(df_layer)
df_layer <- df_all |>
group_by(model, layer) |>
summarise(
sensitivity = sum(sensitivity)
) |>
arrange(model, sensitivity)
View(df_layer)
?arrange
df_layer <- df_all |>
group_by(model, layer) |>
summarise(
sensitivity = sum(sensitivity)
) |>
arrange(model, desc(sensitivity))
View(df_layer)
library(tidyverse)
args <- commandArgs(trailingOnly = TRUE)
if (length(args) == 0) {
csv_fp <- "data/llama-sensitivity1.csv"
} else {
csv_fp <- args[1]
}
df_all <- read_csv(csv_fp)
df_layer <- df_all |>
group_by(model, layer) |>
summarise(
sensitivity = sum(sensitivity)
) |>
arrange(model, desc(sensitivity))
View(df_layer)
View(df_all)
library(tidyverse)
args <- commandArgs(trailingOnly = TRUE)
if (length(args) == 0) {
csv_fp <- "data/llama-sensitivity.csv"
} else {
csv_fp <- args[1]
}
df_all <- read_csv(csv_fp)
View(df_all)
df_layer <- df_all |>
group_by(nbits, group_size, model, layer) |>
summarise(
sensitivity = sum(sensitivity)
)
View(df_layer)
df_layer <- df_all |>
group_by(nbits, group_size, model, layer) |>
summarise(
sensitivity = sum(sensitivity)
) |>
mutate(
cfg = paste0("b", nbits, "g", group_size)
) |>
select(-c("nbits", "group_size"))
View(df_layer)
df_layer <- df_all |>
group_by(nbits, group_size, model, layer) |>
summarise(
sensitivity = sum(sensitivity)
) |>
mutate(
cfg = paste0("b", nbits, "g", group_size)
) |>
select(-c("nbits", "group_size"))
View(df_layer)
df_layer <- df_all |>
group_by(nbits, group_size, model, layer) |>
summarise(
sensitivity = sum(sensitivity)
) |>
ungroup() |>
mutate(
cfg = paste0("b", nbits, "g", group_size)
) |>
select(-c("nbits", "group_size"))
View(df_layer)
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 0.5,
aes(shape = cfg, color = cfg, y = ppl)
) +
geom_point(size = 1.5) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_wrap(~model, scales = "free") +
scale_color_solarized()
library(ggthemes)
library(ggplot)
args <- commandArgs(trailingOnly = TRUE)
if (length(args) == 0) {
csv_fp <- "data/llama-sensitivity.csv"
} else {
csv_fp <- args[1]
}
df_all <- read_csv(csv_fp)
df_layer <- df_all |>
group_by(nbits, group_size, model, layer) |>
summarise(
sensitivity = sum(sensitivity)
) |>
ungroup() |>
mutate(
cfg = paste0("b", nbits, "g", group_size)
) |>
select(-c("nbits", "group_size"))
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 0.5,
aes(shape = cfg, color = cfg, y = ppl)
) +
geom_point(size = 1.5) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_wrap(~model, scales = "free") +
scale_color_solarized()
plt
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 0.5,
aes(shape = cfg, color = cfg)
) +
geom_point(size = 1.5) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_wrap(~model, scales = "free") +
scale_color_solarized()
plt
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 0.5,
aes(shape = cfg, color = cfg)
) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_wrap(~model, scales = "free") +
scale_color_solarized()
plt
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 0.5,
aes(shape = cfg, color = cfg)
) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_wrap(~model, scales = "free", ncol = 1) +
scale_color_solarized()
plt
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 0.5,
aes(shape = cfg, color = cfg)
) +
geom_line() +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_wrap(~model, scales = "free", ncol = 1) +
scale_color_solarized()
plt
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 0.5,
aes(shape = cfg, color = cfg)
) +
geom_line(
size = 0.5,
aes(shape = cfg, color = cfg)
) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_wrap(~model, scales = "free", ncol = 1) +
scale_color_solarized()
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 0.5,
aes(shape = cfg, color = cfg)
) +
geom_line(
size = 0.5,
aes(color = cfg)
) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_wrap(~model, scales = "free", ncol = 1) +
scale_color_solarized()
plt
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 0.5,
aes(shape = cfg, color = cfg)
) +
geom_line(
size = 0.5,
aes(color = cfg)
) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_wrap(~model, scales = "free", nrow = 1) +
scale_color_solarized()
plt
df_layer <- df_all |>
group_by(nbits, group_size, model, layer) |>
summarise(
sensitivity = sum(sensitivity)
) |>
ungroup() |>
mutate(
cfg = paste0("b", nbits, "g", group_size)
) |>
select(-c("nbits", "group_size")) |>
filter(
cfg != "b3g128"
)
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 0.5,
aes(shape = cfg, color = cfg)
) +
geom_line(
size = 0.5,
aes(color = cfg)
) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_wrap(~model, scales = "free", nrow = 1) +
scale_color_solarized()
plt
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 1.5,
aes(shape = cfg, color = cfg)
) +
geom_line(
size = 0.5,
aes(color = cfg)
) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_wrap(~model, scales = "free", nrow = 1) +
scale_color_solarized()
plt
library(tidyverse)
library(ggthemes)
library(ggplot)
args <- commandArgs(trailingOnly = TRUE)
if (length(args) == 0) {
csv_fp <- "data/llama-sensitivity.csv"
} else {
csv_fp <- args[1]
}
df_all <- read_csv(csv_fp)
df_layer <- df_all |>
group_by(dataset, nbits, group_size, model, layer) |>
summarise(
sensitivity = sum(sensitivity)
) |>
ungroup() |>
mutate(
cfg = paste0("b", nbits, "g", group_size)
) |>
select(-c("nbits", "group_size"))
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 1.5,
aes(shape = cfg, color = cfg)
) +
geom_line(
size = 0.5,
aes(color = cfg)
) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_grid(dataset ~ model, scales = "free") +
scale_color_solarized()
plt
source("~/work/lm-quant-toolkit/data-vis/plot-sensitivity.R")
library(ggplot)
library(ggplot2)
library(tidyverse)
library(ggthemes)
library(ggplot2)
args <- commandArgs(trailingOnly = TRUE)
if (length(args) == 0) {
csv_fp <- "data/llama-sensitivity.csv"
} else {
csv_fp <- args[1]
}
df_all <- read_csv(csv_fp)
df_layer <- df_all |>
group_by(dataset, nbits, group_size, model, layer) |>
summarise(
sensitivity = sum(sensitivity)
) |>
ungroup() |>
mutate(
cfg = paste0("b", nbits, "g", group_size)
) |>
select(-c("nbits", "group_size"))
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 1.5,
aes(shape = cfg, color = cfg)
) +
geom_line(
size = 0.5,
aes(color = cfg)
) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_grid(dataset ~ model, scales = "free") +
scale_color_solarized()
plt
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 1.5,
aes(shape = cfg, color = cfg)
) +
geom_line(
size = 0.5,
aes(color = cfg)
) +
labs(x = "Layer", y = "Sensitivity") +
theme_gray(base_size = 14) +
facet_grid(model ~ dataset, scales = "free") +
scale_color_solarized()
plt
plt <- ggplot(df_layer, aes(x = layer, y = sensitivity)) +
geom_point(
size = 1.5,
aes(shape = cfg, color = cfg)
) +
geom_line(
size = 0.5,
aes(color = cfg)
) +
labs(x = "Layer", y = "Sensitivity") +
scale_y_continuous(trans = "log10") +
theme_gray(base_size = 14) +
facet_grid(model ~ dataset, scales = "free") +
scale_color_solarized()
plt
